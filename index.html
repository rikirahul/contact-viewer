<!DOCTYPE html>
<html>
<head>
    <title>Contact Viewer</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            margin: 20px;
        }
        .filters {
            margin-top: 20px;
        }
        .table-container {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center my-4">Contact Viewer</h1>

        <!-- Search Bar -->
        <div class="row mb-4">
            <div class="col-12">
                <input type="text" id="searchInput" class="form-control" placeholder="Search by any field...">
            </div>
        </div>

        <!-- Filters -->
        <div class="row filters">
            <div class="col-md-4 mb-3">
                <select id="blockDropdown" class="form-select">
                    <!-- Values will be populated dynamically -->
                </select>
            </div>
            <div class="col-md-4 mb-3">
                <select id="departmentDropdown" class="form-select">
                    <!-- Values will be populated dynamically -->
                </select>
            </div>
            <div class="col-md-4 mb-3">
                <select id="designationDropdown" class="form-select">
                    <!-- Values will be populated dynamically -->
                </select>
            </div>
        </div>

        <!-- Table for Displaying Contacts -->
        <div class="table-container">
            <table class="table table-bordered table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Block</th>
                        <th>Department</th>
                        <th>Designation</th>
                        <th>Contact Number</th>
                    </tr>
                </thead>
                <tbody id="contactsTable">
                    <!-- Data will be populated dynamically -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const apiUrl = "https://script.google.com/macros/s/AKfycbwuFgIxmgQ2G3NLpwDQP1OzY3mqfpUwS89kaI6pmEq4owyvvt_kCcedTDJiMuxwNTCv/exec";

        // Fetch unique dropdown values from Google Sheets
        async function fetchDropdownValues() {
            const response = await fetch(apiUrl);
            const data = await response.json();

            populateDropdown("blockDropdown", data.blocks, "Block");
            populateDropdown("departmentDropdown", data.departments, "Department");
            populateDropdown("designationDropdown", data.designations, "Designation");
        }

        function populateDropdown(dropdownId, values, label) {
            const dropdown = document.getElementById(dropdownId);
            dropdown.innerHTML = `<option value="">Select ${label}</option>`;
            values.forEach(value => {
                const option = document.createElement("option");
                option.value = value;
                option.textContent = value;
                dropdown.appendChild(option);
            });
        }

        // Fetch contacts based on filters and search input
        async function fetchContacts() {
            const block = document.getElementById('blockDropdown').value;
            const department = document.getElementById('departmentDropdown').value;
            const designation = document.getElementById('designationDropdown').value;
            const search = document.getElementById('searchInput').value;

            const query = new URLSearchParams({ block, department, designation, search });
            const response = await fetch(`${apiUrl}?${query.toString()}`);
            const data = await response.json();

            displayContacts(data);
        }

        function displayContacts(contacts) {
            const tableBody = document.getElementById('contactsTable');
            tableBody.innerHTML = '';

            if (contacts.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" class="text-center">No contacts found</td></tr>';
                return;
            }

            contacts.forEach(contact => {
                const row = `
                    <tr>
                        <td>${contact.Block}</td>
                        <td>${contact.Department}</td>
                        <td>${contact.Designation}</td>
                        <td>${contact["Contact Number"]}</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        // Initialize dropdowns and fetch contacts
        fetchDropdownValues();
        document.getElementById('blockDropdown').addEventListener('change', fetchContacts);
        document.getElementById('departmentDropdown').addEventListener('change', fetchContacts);
        document.getElementById('designationDropdown').addEventListener('change', fetchContacts);
        document.getElementById('searchInput').addEventListener('input', fetchContacts);
    </script>
</body>
</html>
